services:
  tidaloader:
    build:
      context: .
      args:
        USER_UID: ${USER_UID:-1000}
        USER_GID: ${USER_GID:-1000}
    container_name: tidaloader
    ports:
      - "8001:8001"
    environment:
      - MUSIC_DIR=${MUSIC_DIR:-/music}
      - AUTH_USERNAME=${AUTH_USERNAME:-admin}
      - AUTH_PASSWORD=${AUTH_PASSWORD:-changeme}
      # Queue configuration
      - MAX_CONCURRENT_DOWNLOADS=${MAX_CONCURRENT_DOWNLOADS:-3}
      - QUEUE_AUTO_PROCESS=${QUEUE_AUTO_PROCESS:-true}
    volumes:
      - ${MUSIC_DIR_HOST:-./music}:/music
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8001/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
